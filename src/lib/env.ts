/*
 * Code generated by Speakeasy (https://speakeasy.com). DO NOT EDIT.
 */

import * as z from "zod/v3";
import { SDKOptions } from "./config.js";
import { dlv } from "./dlv.js";

export interface Env {
  CLIENT_API_KEY?: string | undefined;
  CLIENT_O_AUTH?: string | undefined;

  /**
   * Sets the profileId parameter for all supported operations
   */
  CLIENT_PROFILE_ID?: string | undefined;

  /**
   * Sets the testmode parameter for all supported operations
   */
  CLIENT_TESTMODE?: boolean | undefined;

  /**
   * Sets the customUserAgent parameter for all supported operations
   */
  CLIENT_CUSTOM_USER_AGENT?: string | undefined;

  CLIENT_DEBUG?: boolean | undefined;
}

export const envSchema: z.ZodType<Env, z.ZodTypeDef, unknown> = z.object({
  CLIENT_API_KEY: z.string().optional(),
  CLIENT_O_AUTH: z.string().optional(),

  CLIENT_PROFILE_ID: z.string().optional(),
  CLIENT_TESTMODE: z.enum(["true", "false"]).transform(v => v === "true")
    .optional(),
  CLIENT_CUSTOM_USER_AGENT: z.string().optional(),

  CLIENT_DEBUG: z.coerce.boolean().optional(),
});

/**
 * Checks for the existence of the Deno global object to determine the environment.
 * @returns {boolean} True if the runtime is Deno, false otherwise.
 */
function isDeno() {
  if ("Deno" in globalThis) {
    return true;
  }

  return false;
}

let envMemo: Env | undefined = undefined;
/**
 * Reads and validates environment variables.
 */
export function env(): Env {
  if (envMemo) {
    return envMemo;
  }

  let envObject: Record<string, unknown> = {};
  if (isDeno()) {
    envObject = (globalThis as any).Deno?.env?.toObject?.() ?? {};
  } else {
    envObject = dlv(globalThis, "process.env") ?? {};
  }

  envMemo = envSchema.parse(envObject);
  return envMemo;
}

/**
 * Clears the cached env object. Useful for testing with a fresh environment.
 */
export function resetEnv() {
  envMemo = undefined;
}

/**
 * Populates global parameters with environment variables.
 */
export function fillGlobals(options: SDKOptions): SDKOptions {
  const clone = { ...options };

  const envVars = env();

  if (typeof envVars.CLIENT_PROFILE_ID !== "undefined") {
    clone.profileId ??= envVars.CLIENT_PROFILE_ID;
  }
  if (typeof envVars.CLIENT_TESTMODE !== "undefined") {
    clone.testmode ??= envVars.CLIENT_TESTMODE;
  }
  if (typeof envVars.CLIENT_CUSTOM_USER_AGENT !== "undefined") {
    clone.customUserAgent ??= envVars.CLIENT_CUSTOM_USER_AGENT;
  }

  return clone;
}
